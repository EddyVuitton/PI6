@page "/home"

<CascadingAuthenticationState>
    <div class="d-flex flex-column align-center justify-center">
        <div style="margin: 1%; width: 90%">
            <AdvCarousel />
        </div>
    </div>
    <div class="d-flex flex-column align-center justify-center">
        <div style="margin: 1%; width: 90%">
            <AuthorizeView Roles=@_otherRoles>
                <Authorized>
                    <div style="width: 400px;" class="d-flex flex-row align-start">
                        <MudPaper Elevation="0">
                            <MudButton Size="Size.Medium"
                                       Variant="Variant.Filled"
                                       Color="Color.Primary"
                                       Href="/newquiz"
                                       Style="text-transform:none; font-size: 20px">
                                Nowy test
                            </MudButton>
                        </MudPaper>
                    </div>
                    <br />
                    <MudText Align="Align.Left" Typo="Typo.h3">Stworzone testy</MudText>
                    <br />
                    <div class="d-flex justify-start flex-grow-1 flex-wrap gap-y-4 gap-x-4" style="width: 70%;">
                        @if (_formTiles is null)
                        {
                            <MudText>
                                Ładowanie formularzy...
                            </MudText>
                        }
                        else
                        {
                            <FormTilesIndex FormTiles="@_formTiles" />
                        }
                    </div>
                </Authorized>
            </AuthorizeView>
            <AuthorizeView Roles=@_studentRole>
                <Authorized>
                    <div class="d-flex justify-start flex-grow-1 flex-wrap gap-y-4 gap-x-4" style="width: 70%;">
                        @if (_formTiles is null)
                        {
                            <MudText>
                                Ładowanie formularzy...
                            </MudText>
                        }
                        else
                        {
                            <div class="d-flex flex-column gap-y-8">
                                <MudText Align="Align.Left" Typo="Typo.h3">Aktywne testy do rozwiązania</MudText>
                                @if (_activeFormTiles is not null)
                                {
                                    @if (_activeFormTiles.Count > 0)
                                    {
                                        <FormTilesIndex FormTiles="@_activeFormTiles" />
                                    }
                                    else
                                    {
                                        <MudText Align="Align.Left">Brak...</MudText>
                                    }
                                }

                                <MudText Align="Align.Left" Typo="Typo.h3">Nierozwiązane testy przez zamknięciem</MudText>
                                @if (_deactiveFormTiles is not null)
                                {
                                    @if (_deactiveFormTiles.Count > 0)
                                    {
                                        <FormTilesIndex FormTiles="@_deactiveFormTiles" />
                                    }
                                    else
                                    {
                                        <MudText Align="Align.Left">Brak...</MudText>
                                    }
                                }

                                <MudText Align="Align.Left" Typo="Typo.h3">Rozwiązane testy</MudText>
                                @if (_solvedForms is not null)
                                {
                                    @if (_solvedForms.Count > 0)
                                    {
                                        <div class="d-flex flex-row gap-x-2">
                                            @foreach (var f in _solvedForms)
                                            {
                                                var localHref = $"/formsolveddetails/{f.fpod_id}";
                                                var localTile = _formTiles.First(x => x.ForId == f.fpod_for_id);
                                                var localForm = _forms.Where(x => x.for_id == localTile.ForId).First();
                                                var localDateFrom = f.fpod_data_rozpoczenia.ToString("dd/MM/yyyy HH:mm");
                                                var localDateTo = f.fpod_data_zakonczenia?.ToString("dd/MM/yyyy HH:mm");
                                                var localPointsSum = _formsPointsSum.Where(x => x.Key == localForm).First().Value;
                                                var localUserPointsSum = _formsUserPointsSum.Where(x => x.Key == localForm).First().Value;

                                                <MudPaper Elevation="10" Width="300px" Class="d-flex flex-column justify-space-between">
                                                    <div style="height: 150px; margin: 1%;">
                                                        <MudLink Href="@localHref">
                                                            <div class="d-flex flex-column justify-space-between overflow-scroll" style="height:100%;">
                                                                <div>
                                                                    <span style="color: black; font-weight: bold; font-size: 20px;">@localTile.Nazwa</span>
                                                                </div>
                                                                <div class="d-flex flex-column">
                                                                    <span style="color: black;">Rozpoczęto: @localDateFrom</span>
                                                                    <span style="color: black;">Zakończono: @localDateTo</span>
                                                                    <span style="color: black;">Punkty: @localUserPointsSum/@localPointsSum</span>
                                                                </div>
                                                            </div>
                                                        </MudLink>
                                                    </div>
                                                </MudPaper>
                                            }
                                        </div>
                                    }
                                    else
                                    {
                                        <MudText Align="Align.Left">Brak...</MudText>
                                    }
                                }
                            </div>
                        }
                    </div>
                </Authorized>
            </AuthorizeView>
        </div>
    </div>
</CascadingAuthenticationState>