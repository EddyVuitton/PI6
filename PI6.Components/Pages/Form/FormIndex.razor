@page "/home"

<CascadingAuthenticationState>
    <div class="d-flex flex-column align-center justify-center">
        <div style="margin: 1%; width: 90%">
            <AdvCarousel />
        </div>
    </div>
    <div class="d-flex flex-column align-center justify-center">
        <div style="margin: 1%; width: 90%">
            <AuthorizeView Roles=@_otherRoles>
                <Authorized>
                    <div style="width: 400px;" class="d-flex flex-row align-start">
                        <MudPaper Elevation="0">
                            <MudButton Size="Size.Medium"
                                       Variant="Variant.Filled"
                                       Color="Color.Primary"
                                       Href="/newquiz"
                                       Style="text-transform:none; font-size: 20px">
                                Nowy test
                            </MudButton>
                        </MudPaper>
                    </div>
                    <br />
                    <MudText Align="Align.Left" Typo="Typo.h3">Stworzone testy</MudText>
                    <br />
                    <div class="d-flex justify-start flex-grow-1 flex-wrap gap-y-4 gap-x-4" style="width: 70%;">
                        @if (_formTiles is null)
                        {
                            <MudText>
                                Ładowanie formularzy...
                            </MudText>
                        }
                        else
                        {
                            <FormTilesIndex FormTiles="@_formTiles" Account="@_accountDto" />
                        }
                    </div>
                </Authorized>
            </AuthorizeView>
            <AuthorizeView Roles=@_studentRole>
                <Authorized>
                    <div class="d-flex justify-start flex-grow-1 flex-wrap gap-y-4 gap-x-4" style="width: 70%;">
                        @if (_formTiles is null)
                        {
                            <MudText>
                                Ładowanie formularzy...
                            </MudText>
                        }
                        else
                        {
                            <div class="d-flex flex-column gap-y-8">
                                @if (_activeFormTiles.Count > 0)
                                {
                                    <div>
                                        <MudText Align="Align.Left" Typo="Typo.h3">Aktywne testy do rozwiązania</MudText>
                                        <FormTilesIndex FormTiles="@_activeFormTiles" Account="@_accountDto" />
                                    </div>
                                }

                                @if (_deactiveFormTiles.Count > 0)
                                {
                                    <div>
                                        <MudText Align="Align.Left" Typo="Typo.h3">Zamknięte testy</MudText>
                                        <FormTilesIndex FormTiles="@_deactiveFormTiles" Account="@_accountDto" />
                                    </div>
                                }

                                @if (_solvedForms.Count > 0)
                                {
                                    <div>
                                        <MudText Align="Align.Left" Typo="Typo.h3">Rozwiązane testy</MudText>
                                        @foreach (var f in _solvedForms)
                                        {
                                            var tempHref = $"/formdetails/{f.fpod_for_id}";
                                            var tempEndDate = f.fpod_data_zakonczenia.HasValue == true ? f.fpod_data_zakonczenia.Value.Date.ToShortDateString() : "Nie określono";
                                            var tile = _formTiles.First(x => x.ForId == f.fpod_for_id);

                                            <MudPaper Elevation="10" Style="width: 300px;">
                                                <MudLink Href="@tempHref">
                                                    <div class="d-flex flex-column justify-start">
                                                        <div class="d-flex justify-start flex-column flex-grow-1" style="margin: 1% 1% 2% 1%; background-color: inherit;">
                                                            <MudText Style="color: black; font-weight: bold;">@tile.Nazwa</MudText>
                                                            <MudText Style="color: black;">Data rozpoczęcia: @f.fpod_data_rozpoczenia.ToShortDateString()</MudText>
                                                            <MudText Style="color: black;">Data zakończenia: @f.fpod_data_zakonczenia.Value.ToShortDateString()</MudText>
                                                        </div>
                                                    </div>
                                                </MudLink>
                                            </MudPaper>
                                        }
                                    </div>
                                }
                            </div>
                        }
                    </div>
                </Authorized>
            </AuthorizeView>
        </div>
    </div>
</CascadingAuthenticationState>